import{A as u,q as _,x as R,r as f,o as g,b as y,w as s,a as I,d as D,p as h,t as L,z as w}from"./index.f1d70c0e.js";import{f as x}from"./util.967435f9.js";const M=a=>u.get("/api/comment",{params:a}),N=a=>u.delete(`/api/comment/${a}`),O=a=>u.get("/api/reply",{params:a}),P=a=>u.delete(`/api/reply/${a}`),V={class:"px-5 py-2"},S={__name:"comment",setup(a){const r=_(!1),p=_([]),n=R({page:1,limit:10,total:0}),C=_(-1),k={showAdd:!1,showRowEdit:!1,columns:[{label:"\u8BC4\u8BBA\u65F6\u95F4",formatter:e=>x(e.createdAt)},{label:"\u6635\u79F0",formatter:e=>{var t;return(t=e.user)==null?void 0:t.name}},{label:"\u8BC4\u8BBA\u5185\u5BB9",prop:"content"},{label:"\u8BC4\u8BBA\u6587\u7AE0",slot:"article"}]},d=R({}),A={showAdd:!1,showRowEdit:!1,height:"300px",columns:[{label:"\u56DE\u590D\u65F6\u95F4",formatter:e=>x(e.createdAt,"YYYY-MM-DD hh:mm")},{label:"\u6635\u79F0",formatter:e=>{var t;return(t=e.user)==null?void 0:t.name}},{label:"@",formatter:e=>{var t;return(t=e.toUser)==null?void 0:t.name}},{label:"\u8BC4\u8BBA\u5185\u5BB9",prop:"content"}]};m();async function m(){if(r.value)return;r.value=!0;const e=await M({page:n.page,limit:n.limit,articleId:C.value});p.value=e.rows,n.total=e.total,r.value=!1}async function T(e){if(await N(e.id)){const i=p.value.indexOf(e);i!==-1&&(p.value.splice(i,1),n.total-=1),w.success("\u5220\u9664\u6210\u529F")}}async function $(e,t){if(await P(e.id)){const c=d[t].indexOf(e);c!==-1&&d[t].splice(c,1),w.success("\u5220\u9664\u6210\u529F")}}function Y(){n.page=1,m()}async function b(e){const t=await O({commentId:e,limit:1e8});t&&(d[e]=t.rows)}return(e,t)=>{const i=f("el-button"),c=f("ProTable"),B=f("el-tag"),E=f("router-link");return g(),y(c,{data:p.value,options:k,loading:r.value,page:n,onDeleteRow:T,onRefresh:m,onChangePage:m,onChangeLimit:Y},{expand:s(({row:o})=>[I("div",V,[o.replyCount>0?(g(),y(c,{key:0,data:d[o.id],options:A,onDeleteRow:l=>$(l,o.id),onRefresh:l=>b(o.id)},{empty:s(()=>[D(i,{onClick:l=>b(o.id),type:"primary",size:"small"},{default:s(()=>[h("\u83B7\u53D6\u56DE\u590D")]),_:2},1032,["onClick"])]),_:2},1032,["data","onDeleteRow","onRefresh"])):(g(),y(B,{key:1,type:"info"},{default:s(()=>[h("\u6CA1\u6709\u56DE\u590D")]),_:1}))])]),article:s(({row:o})=>{var l;return[D(E,{to:`/article/add?editId=${(l=o.article)==null?void 0:l.id}`,class:"el-link el-link--primary is-underline"},{default:s(()=>{var v;return[h(L((v=o.article)==null?void 0:v.title),1)]}),_:2},1032,["to"])]}),_:1},8,["data","loading","page"])}}};export{S as default};
